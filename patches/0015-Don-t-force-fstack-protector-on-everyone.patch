From e57e2d657f3b6b8981983b1d31294ddfcdca0996 Mon Sep 17 00:00:00 2001
From: Vladimir Smirnov <civil@gentoo.org>
Date: Mon, 19 May 2014 19:44:44 +0400
Subject: [PATCH 15/28] Don't force -fstack-protector on everyone

Bug-Gentoo: https://bugs.gentoo.org/348557

Patch-Name: gentoo/drop_fstack_protector.diff

Original by Torsten Veller, ported to perl 5.20
---
 Configure | 48 ------------------------------------------------
 1 file changed, 48 deletions(-)

diff --git a/Configure b/Configure
index f6d4823b30..e80d616d6e 100755
--- a/Configure
+++ b/Configure
@@ -5445,24 +5445,6 @@ default|recommended)
 	# is to add the flag to the flags passed to the compiler at link time,
 	# as that way the compiler can do the right implementation dependant
 	# thing. (NWC)
-	case "$ccflags" in
-	*-fno-stack-protector*)
-	    echo "Do not add -fstack-protector nor -fstack-protector-strong" 2>&1
-	    ;;
-	*) case "$gccversion" in
-	   ?*)	set stack-protector-strong -fstack-protector-strong
-		eval $checkccflag
-		case "$dflt" in
-		*-fstack-protector-strong*) ;; # It got added.
-		*) # Try the plain/older -fstack-protector.
-		   set stack-protector -fstack-protector
-		   eval $checkccflag
-		   ;;
-		esac
-		;;
-	    esac
-	    ;;
-	esac
 esac
 
 case "$mips_type" in
@@ -5605,21 +5587,6 @@ case "$ldflags" in
 	;;
 *) dflt="$ldflags";;
 esac
-# See note above about -fstack-protector
-case "$ccflags" in
-*-fstack-protector-strong*)
-	case "$dflt" in
-	*-fstack-protector-strong*) ;; # Don't add it again
-	*) dflt="$dflt -fstack-protector-strong" ;;
-	esac
-	;;
-*-fstack-protector*)
-	case "$dflt" in
-	*-fstack-protector*) ;; # Don't add it again
-	*) dflt="$dflt -fstack-protector" ;;
-	esac
-	;;
-esac
 
 : Try to guess additional flags to pick up local libraries.
 for thislibdir in $libpth; do
@@ -8543,21 +8510,6 @@ EOM
 	    ''|' ') dflt='none' ;;
 	esac
 
-	case "$ldflags" in
-	    *-fstack-protector-strong*)
-		case "$dflt" in
-		    *-fstack-protector-strong*) ;; # Don't add it again
-		    *) dflt="$dflt -fstack-protector-strong" ;;
-		esac
-		;;
-	    *-fstack-protector*)
-		case "$dflt" in
-		    *-fstack-protector*) ;; # Don't add it again
-		    *) dflt="$dflt -fstack-protector" ;;
-		esac
-		;;
-	esac
-
 	rp="Any special flags to pass to $ld to create a dynamically loaded library?"
 	. ./myread
 	case "$ans" in
-- 
2.39.3

